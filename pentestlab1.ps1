New-LabDefinition -Name pentestlab1 -DefaultVirtualizationEngine HyperV

Add-LabIsoImageDefinition -Name SQLServer2014 -Path $labSources\ISOs\SQLServer2014SP3-FullSlipstream-x64-ENU.iso

#define the virtual network
Add-LabVirtualNetworkDefinition -Name 'pentest1' -AddressSpace 10.10.10.0/16 

#defining default parameter values, as these ones are the same for all the machines
$PSDefaultParameterValues = @{
    'Add-LabMachineDefinition:DomainName' = 'contoso.com'
    'Add-LabMachineDefinition:Memory' = 1GB
    'Add-LabMachineDefinition:OperatingSystem' = 'Windows Server 2016 Datacenter (Desktop Experience)'
}

$postInstallActivity = Get-LabPostInstallationActivity -ScriptFileName PrepareRootDomain.ps1 -DependencyFolder $labSources\PostInstallationActivities\PrepareRootDomain
Add-LabMachineDefinition -Name DC1 -Roles RootDC -PostInstallationActivity $postInstallActivity

Add-LabMachineDefinition -Name SQL1 -Roles SQLServer2014

#Client1
Add-LabMachineDefinition -Name Client1 -OperatingSystem 'Windows 10 Pro'
#disable Defender von Client1
Invoke-LabCommand -ScriptBlock { Set-MpPreference -DisableRealtimeMonitoring $true } -ComputerName Client1 -PassThru

#Client2 AV1 Kaspersky
#Add-LabMachineDefinition -Name Client1 -OperatingSystem 'Windows 10 Pro'
#Install-LabSoftwarePackage -ComputerName Server1 -Path $labSources\SoftwarePackages\Notepad++.exe -CommandLine /S

#Client3 AV2 Sophos
#Add-LabMachineDefinition -Name Client1 -OperatingSystem 'Windows 10 Pro'
#Install-LabSoftwarePackage -ComputerName Server1 -Path $labSources\SoftwarePackages\Notepad++.exe -CommandLine /S

Install-Lab

Show-LabDeploymentSummary -Detailed
